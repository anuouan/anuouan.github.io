# linux安装redis

## 一、redis安装

在CentOS 7中安装Redis的详细步骤和命令如下：

**检查GCC依赖**：
Redis是用C语言开发的，因此在安装之前，你需要确认是否已安装GCC环境。可以通过以下命令进行检查：

```bash
gcc -v
```

如果命令执行后没有任何显示，证明没有安装GCC。此时，你需要执行以下命令来安装GCC：

```bash
yum install -y gcc
```

**创建相关文件夹**：
为了进行准备工作，你需要进入`/usr/local/`目录并创建一个名为`redis`的文件夹：

```bash
cd /usr/local/  
mkdir redis  
cd redis
```

**下载并解压Redis安装包**：
你可以从Redis的官方网站或其他可信的源下载Redis安装包。假设你选择了Redis 7.0.14版本，可以使用以下命令下载并解压：

```bash
wget http://download.redis.io/releases/redis-7.0.14.tar.gz  
tar -zxvf redis-7.0.14.tar.gz
```

**编译Redis**：
进入解压后的目录，并执行编译命令：

```bash
cd redis-7.0.14  
make
```

**安装Redis**：
编译完成后，进入`src`目录并执行安装命令：

```bash
cd src  
make install
```

**启动Redis**：
安装完成后，你可以通过以下命令启动Redis服务：

```bash
redis-server
```

默认情况下，Redis会在前台运行。如果你想让Redis在后台运行，可以修改Redis的配置文件`redis.conf`，将`daemonize`选项设置为`yes`，然后重新启动Redis服务。

**检查Redis是否运行**：

你可以使用以下命令检查Redis是否正在运行：

```bash
ps -ef | grep redis
```

如果看到与Redis相关的进程信息，则表示Redis已成功运行。

请注意，上述步骤和命令是基于CentOS 7和Redis 7.0.14版本的。如果你使用的是其他版本或不同的操作系统，可能需要进行适当的调整。此外，为了确保Redis的安全性和稳定性，建议查阅Redis的官方文档以获取更多关于配置和管理的信息。

## 二、redis开机自启

在CentOS 7中，要让Redis服务在系统启动时自动运行，你可以通过将其添加到systemd服务管理来实现。以下是配置Redis为自启动服务的步骤：

**创建Redis的systemd服务文件**：

首先，你需要在`/etc/systemd/system/`目录下创建一个新的服务文件，例如`redis.service`。你可以使用以下命令来创建并编辑该文件：

```bash
sudo vi /etc/systemd/system/redis.service
```

然后，将以下内容粘贴到文件中：

```ini
[Unit]  
Description=Redis persistent key-value database  
After=network.target  
  
[Service]  
ExecStart=/usr/local/bin/redis-server /usr/local/redis/redis-7.0.14/redis.conf  
ExecStop=/usr/local/bin/redis-cli shutdown  
Restart=always  
User=redis  
Group=redis  
UMask=0077  
PrivateTmp=yes  
  
[Install]  
WantedBy=multi-user.target
```

**重新加载systemd配置**：

在创建或修改了systemd服务文件后，你需要重新加载systemd的配置，使其识别新的服务文件：

```bash
sudo systemctl daemon-reload
```

**设置Redis服务开机自启**：

使用以下命令启用Redis服务的自启动：

```bash
sudo systemctl enable redis
```

**启动Redis服务**：

在启动Redis服务之前，确保Redis的配置文件是正确的，并且Redis的数据目录存在并且具有正确的权限。然后，你可以使用以下命令启动Redis服务：

```bash
sudo systemctl restart redis
```

**检查Redis服务状态**：

你可以使用以下命令来检查Redis服务的状态：

```bash
sudo systemctl status redis
```

如果一切正常，你应该会看到Redis服务正在运行的信息。

**（可选）创建Redis用户和组**：

如果你之前没有在`redis.service`文件中指定`User`和`Group`，或者想要为Redis创建专用的用户和组以增强安全性，你可以使用以下命令创建它们：

```bash
sudo groupadd redis  
sudo useradd -g redis -s /sbin/nologin redis
```

这里`-s /sbin/nologin`表示这个用户不能登录系统，只用于运行Redis服务。然后，你需要修改Redis数据目录和其他相关目录的权限，使它们属于`redis`用户和组。

完成以上步骤后，Redis服务应该会在系统启动时自动运行了。如果以后需要停止、重启或查看Redis服务的状态，你可以使用`systemctl`命令，如`systemctl stop redis`、`systemctl restart redis`和`systemctl status redis`。

## 三、redis远程连接

为了配置Redis以允许远程连接并使用密码进行身份验证，你需要修改Redis的配置文件，并确保防火墙和网络设置允许远程访问Redis端口。以下是如何配置的步骤：

### 1. 修改Redis配置文件

找到Redis的配置文件`redis.conf`，通常这个文件位于Redis的安装目录下。编辑这个文件，并找到以下相关的配置项：

```bash
cd /usr/local/redis/redis-7.0.14
vim redis.conf
```

#### 允许远程连接

默认情况下，Redis只监听本地连接。为了允许远程连接，你需要修改`bind`配置项，将其注释掉或者设置为`0.0.0.0`，以监听所有网络接口：

```conf
# bind 127.0.0.1
```

或者：

```conf
bind 0.0.0.0
```

#### 设置密码

要设置密码，你需要取消注释`requirepass`配置项，并设置一个强密码：

```conf
requirepass root
```

<img src="4.linux安装redis.assets/image-20240414182108129.png" alt="image-20240414182108129" style="zoom: 33%;" />

将`root`替换为你想要设置的密码。

#### 修改端口（如果需要）

如果你想要修改Redis的监听端口（默认是6379），你可以修改`port`配置项：

```conf
port your_port_number_here
```

### 2. 重启Redis服务

在修改了配置文件之后，你需要重启Redis服务以使更改生效：

```bash
sudo systemctl restart redis
```

### 3. 配置防火墙

确保你的防火墙允许外部访问Redis的端口。如果你使用的是`firewalld`，你可以使用以下命令来开放端口：

```bash
sudo firewall-cmd --permanent --add-port=6379/tcp  
sudo firewall-cmd --reload
```

### 4. 测试远程连接

现在你可以使用Redis客户端工具（如`redis-cli`）来测试远程连接了。在远程机器上运行以下命令：

```bash
redis-cli -h your_redis_server_ip -p your_port_number_here -a your_password_here
```

将`your_redis_server_ip`替换为你的Redis服务器的IP地址，`your_port_number_here`替换为端口号，`your_password_here`替换为你设置的密码。

如果一切正常，你应该能够连接到Redis服务器并执行命令。

**注意**：允许Redis进行远程连接可能会带来安全风险，特别是如果Redis没有配置密码或使用了弱密码。确保你的Redis服务器使用了强密码，并且只在必要的情况下允许远程连接。同时，考虑使用VPN或SSH隧道等安全方式来访问Redis。